<html>
    <script>
        function load(){

            // Variables
            var token = "";
            var cookie = "login";

            // Get cookie
            var c = document.cookie.split("; ");
            c.forEach(element => {
                if (element.startsWith(cookie)){
                    var c = element.split("=")[1];
                    console.log(c);
                    token = c
                }
            });

            if (token != undefined)
            {
                console.log(document.cookie);
                let data = atob(token.toString());

                const LoginRequest = new XMLHttpRequest();
                LoginRequest.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var response = JSON.parse(this.responseText);
                        if (response.Success){
                            if (response.Message.code == 200){
                                document.getElementById("loggedin").children["username"].innerHTML = "Getting user";
                                document.getElementById("notloggedin").remove();
                                GetUserData(response.Message.data.PlayFabId);
                            }
                        }
                        console.log(this.responseText);
                        console.log("Logged in");
                    }
                }

                var desData = JSON.parse(data);

                var request = {
                    "Platform": "META",
                    "AuthCode": desData.code,
                    "Id": desData.org_scoped_id 
                }

                console.log(request);

            
                LoginRequest.open("POST", "https://fishgame.azurewebsites.net/api/auth/v1/sso/login");
                LoginRequest.send(JSON.stringify(request));
            }
        }

        function GetUserData(userid){
            const DataRequest = new XMLHttpRequest()
            DataRequest.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var data = JSON.parse(this.responseText);
                    if (data.Success){
                        document.getElementById("loggedin").children["username"].innerHTML = data.Message.DisplayName;
                        document.getElementById("loggedin").children["profileimage"].setAttribute("src", data.Message.AvatarUrl);
                    }
                    else{
                        document.getElementById("loggedin").children["username"].innerHTML = "Failed";
                    }
                }
            }

            var r = 'https://fishgame.azurewebsites.net/api/players/v1/get?playFabId=' + userid;
            console.log(r);
            DataRequest.open("GET", r);
            DataRequest.send();
        }

        function getCookie(cookie)
        {
            /*
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            */
            var c = document.cookie.split("; ");
            c.forEach(element => {
                if (element.startsWith(cookie)){
                    var c = element.split("=")[1];
                    console.log(c);
                    return c;
                }
            });
        }
    </script>
    <style>
        /* width */
        ::-webkit-scrollbar {
          width: 10px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
          background: #f1f1f1;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
          background: #888;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .button{
            font-family: "Arial Black", Gadget, sans-serif;
            font-size: 20px;
            padding: 15px;
            text-align: center;
            text-transform: uppercase;
            transition: 0.5s;
            background-size: 200% auto;
            color: rgb(0, 0, 0);
            width: 200px;
            transition: all 0.3s cubic-bezier(.25,.8,.25,1);
            cursor: pointer;
            display: inline-block;
            border-radius: 25px;
            border: none;
            background-image: linear-gradient(135deg, #5ea0dd 0%, #bc97f7 51%, #DD5E89 100%)
        }
        .header{
            padding: 20px;
            background: #FFFFFF;
        }
        .content{
            padding: 20px;
            text-align: center;
        }
        .preview{
            margin: auto;
	        padding: 20px;
        }
        .button:hover {
            color: #0084ff;
        }
        .pfp{
            border-radius: 50%;
            width: 40;
            height: 40;
        }

    </style>
    <head>
        <title>Fish Game</title>
    	<meta content="Fish Game" property="og:title" />
    	<meta content="Pretty fishy game. Download for free on App Lab." property="og:description" />
    	<meta content="https://fishgamevr.com" property="og:url" />
    	<meta content="https://fishgamevr.com/HappiFish.png" property="og:image" />
    	<meta content="#00AEFF" data-react-helmet="true" name="theme-color" />
        <link rel = "icon" href = "https://fishgamevr.com/HappiFish.png" type = "image/x-icon">
        <div class="header">
            <div id="navbuttons" style="vertical-align: middle; display: inline-block;">
                <a href="https://fishgamevr.com/"><img src="https://fishgamevr.com/FishGameTopThing.png" width="107" height="40"></a>
                <a href="https://soundcloud.com/fishgame"><img src="https://fishgamevr.com/Headphones.png" width="40" height="40"></a>
            </div>

            <div id="loggedin" style="vertical-align: middle; display: inline-block; margin-right: 0px">
                <img id="profileimage">
                <a id="username" style= "font-family: Arial; margin-right: auto"></a>
            </div>

            <div id="notloggedin" style="vertical-align: middle; display: inline-block; margin-right: 0px">
                <button class="button" onclick="window.location.href = 'https://auth.oculus.com/sso/?redirect_uri=https%3A%2F%2Ffishgamevr.com%2Flogin&organization_id=426036418974185','_blank'">Login</button>
            </div>
            <!-- <a href="https://fishgamevr.com/privacy-policy" class="button"><pre style="word-wrap: break-word; white-space: pre-wrap;">Privacy Policy</pre></a> --->
        </div>
    </head>
    <body onload="load()" background="https://fishgamevr.com/FishXPWeb.png" style="background-color:#33475b">
        <div class="content"><iframe width="100%" height="404" src="https://www.youtube.com/embed/AsrRBximKvI" title="Fish Game Trailer" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
        <div class="content"><button class="button" onclick="window.open('https://www.oculus.com/experiences/quest/6556848877722096/','_blank')">Download</button></div>
        <!-- <div class="content"><button class="button" onclick="login()">Login</button></div> --->
        <div class="content">
            <img src="https://fishgamevr.com/Fishy1Disc.png" width="23%" height="%10">
            <img src="https://fishgamevr.com/Fishy2Campfire.png" width="23%" height="%10">
            <img src="https://fishgamevr.com/Fishy3Moon.png" width="23%" height="%10">
	        <img src="https://fishgamevr.com/Sandbox.gif" width="23%" height="%10">
        </div>
        <div class="preview">
        <iframe src="https://data.gorillatag.co.uk/fishgame/?duration=48" class="fishgamedb" frameborder="0" border="0" cellspacing="0"
        style="border-style: none;width: 100%; min-height: 450px;"></iframe>
        </div> 
        <div class="content">
            <iframe src="https://discord.com/widget?id=894651526549733397&amp;theme=light" width="350" height="500" allowtransparency="true" frameborder="0" sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>
	    <iframe src="https://www.applabdb.com/" height="500" width="350" style="border:0;overflow:hidden"></iframe>
        </div>
    </body>
</html>
